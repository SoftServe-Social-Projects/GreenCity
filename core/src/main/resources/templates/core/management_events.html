<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <title>Events management</title>
    <link rel="icon" type="image/x-icon" th:href="@{/img/favicon.ico}"/>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/position.css}">
    <link rel="stylesheet" th:href="@{/management/css/table_Modal_Pagination.css}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css"
          integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.2.0/css/all.css"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,700,800&display=swap&subset=cyrillic"
          rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700&display=swap" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
    <script th:src="@{/management/events/buttonsAJAX.js}"></script>
    <script th:src="@{/management/events/confirmationModal.js}"></script>
    <script th:src="@{/management/localization/buttonsAJAX.js}"></script>
</head>
<body>
<div id="header" th:insert="core/header"></div>
<div id="sidebar" th:insert="core/sidepanel"></div>
<div class="main-content">
    <div class="container-xl">
        <div class="row" id="events-content" style="margin:auto">
            <div id="tab-content" style="padding-left: 5%; padding-right: 5%; width: 100%">
                <div id="eco-news" class="row " style="margin-top: 3%; ">
                    <div class="col-sm-8">
                        <h2 class="text-describe text-bold" style=" font-size: 32px; color: #13AA57;">[[#{greenCity.events.page.h}]]</h2>
                    </div>
                    <div class="col-sm-4">
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="d-flex justify-content-end" style="gap:2rem">
                                    <a th:href="@{/management/events/create-event}" class="btn btn-secondary">
                                        <div>[[#{greenCity.events.page.add.event}]]</div>
                                    </a>
                                    <button id="deleteSelectedButton" class="btn btn-remove d-none">
                                        <div>[[#{greenCity.pages.delete}]]</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top: 3%">
                    <div class="col-sm-10">

                    </div>
                    <div class="col-sm-2">
                        <!--                SOME BUTTONS TO CHANGE FORM-->
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="dropdown size">
                                    <img src="/img/arrow-down.svg" alt="arrow-icon" class="change_color">
                                    <button class="dropbtn size" th:text="${pageSize}">
                                    </button>
                                    <div class="dropdown-content size">
                                        <a class="lightgrey" onclick="saveItemsOnPage('20')">20</a>
                                        <a class="lightgrey" onclick="saveItemsOnPage('40')">40</a>
                                        <a class="lightgrey" onclick="saveItemsOnPage('100')">100</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top: 3%">
                    <div class="col-sm-12">
                        <table class="table table-bordered">
                            <thead class="table-primary">
                            <tr>
                                <th style="width: 40px;">
                                    <div class="custom-checkbox">
                                        <input type="checkbox" id="selectAll">
                                        <label for="selectAll"></label>
                                    </div>
                                </th>
                                <th style="width: 120px;">
                                    <span>[[#{greenCity.pages.table.id}]]</span>
                                    <img id="id-icon" class="sorting" src="/img/arrow-up.svg" alt="arrow-icon"
                                         onclick="sortByFieldName('id')">
                                    <span class="table-filter-icon"></span>
                                </th>
                                <th style="width: 180px;">
                                    <span>[[#{greenCity.pages.table.author}]]</span>
                                    <img id="author-icon" class="sorting" src="/img/arrow-up.svg" alt="arrow-icon"
                                         onclick="sortByFieldName('author.name')">
                                    <span class="table-filter-icon"></span>
                                </th>
                                <th style="width: 120px;">
                                    <span>[[#{greenCity.pages.table.title}]]</span>
                                    <img id="title-icon" class="sorting" src="/img/arrow-up.svg" alt="arrow-icon"
                                         onclick="sortByFieldName('title')">
                                    <span class="table-filter-icon"></span>
                                </th>

                                <th style="width: 120px;">
                                    <span>[[#{greenCity.pages.table.text}]]</span>
                                    <img id="text-icon" class="sorting" src="/img/arrow-up.svg" alt="arrow-icon"
                                         onclick="sortByFieldName('text')">
                                    <span class="table-filter-icon"></span>
                                </th>

                                <th style="width: 150px;">
                                    <span>[[#{greenCity.pages.table.tags}]]</span>
                                    <img id="tags-icon" class="sorting" src="/img/arrow-up.svg" alt="arrow-icon"
                                         onclick="sortByFieldName('tags')">
                                    <span class="table-filter-icon"></span>
                                </th>
                                <th>
                                    <span>[[#{greenCity.pages.table.actions}]]</span>
                                </th>
                            </tr>
                            </thead>

                            <tbody>
                            <th:block th:each="allEvents, iterStatus :${pageable.getPage()}">
                                <tr>
                                    <td class="custom-checkbox">
                                        <input type="checkbox" th:id="checkbox+${iterStatus.count}"
                                               name="options[]" th:value="${allEvents.getId()}">
                                        <label th:for="checkbox+${iterStatus.count}"></label>
                                    </td>
                                    <td style="width: 8%">
                                        <span>[[${allEvents.getId()}]]</span>
                                    </td>
                                    <td th:text="${allEvents.organizer.name}" style="white-space: nowrap; /* Заборона переносу */
                                                                                            overflow: hidden;
                                                                                            max-width: 0px;
                                                                                            text-overflow: ellipsis; /* ... */">
                                    </td>
                                    <td th:text="${allEvents.title}" style="white-space: nowrap; /* Заборона переносу */
                                                                                                overflow: hidden;
                                                                                                max-width: 150px;
                                                                                                text-overflow: ellipsis; /* ... */">
                                    </td>
                                    <td th:text="${allEvents.description}" style="white-space: nowrap; /* Заборона переносу */
                                                                                                overflow: hidden;
                                                                                                max-width: 150px;
                                                                                                text-overflow: ellipsis;">
                                    </td>
                                    <td th:text="${allEvents.tagsToStringEn()}">
                                    </td>
                                    <td>
                                        <a th:href="@{/management/events/edit/{id}(id=${allEvents.getId()})}"
                                           class="edit eBtn">
                                            <i class="material-icons" data-toggle="tooltip"
                                               th:title="#{greenCity.pages.edit}">&#xE254;</i>
                                        </a>
                                    </td>
                                </tr>
                            </th:block>
                            </tbody>
                        </table>
                        <!-- Pagination -->
                        <div class="clearfix" th:if="${pageable.getPage().size() ne 0}">
                            <div class="d-flex justify-content-center">
                                <ul class="pagination">
                                    <!-- Previous Page Link -->
                                    <li class="page-item" th:classappend="${pageable.isFirst()} ? 'disabled' : ''">
                                        <a class="page-link" th:if="${!pageable.isFirst()}"
                                           th:href="@{/management/events(page=${pageable.getNumber()-1}, size=${pageSize}, sort=${sort}, query=${query}, id=${eventViewDto.id}, author=${eventViewDto.author}, title=${eventViewDto.title}, description=${eventViewDto.description}, tags=${eventViewDto.tags})}">
                                            <i class="arrow fas fa-chevron-left"></i>
                                        </a>
                                        <a class="page-link" th:if="${pageable.isFirst()}"><i
                                                class="arrow fas fa-chevron-left"></i></a>
                                    </li>

                                    <!-- Page Numbers -->
                                    <li class="page-item"
                                        th:each="pageNumber : ${#numbers.sequence(pageable.getNumber()-3, pageable.getNumber()+3)}"
                                        th:if="${pageNumber > -1 && pageNumber < pageable.getTotalPages()}"
                                        th:classappend="${pageNumber == pageable.getNumber()} ? 'active' : ''">
                                        <a class="page-link"
                                           th:href="@{/management/events(page=${pageNumber}, size=${pageSize}, sort=${sort}, query=${query}, id=${eventViewDto.id}, author=${eventViewDto.author}, title=${eventViewDto.title}, description=${eventViewDto.description}, tags=${eventViewDto.tags})}">
                                            <span th:text="${pageNumber + 1}"></span>
                                        </a>
                                    </li>

                                    <!-- Next Page Link -->
                                    <li class="page-item" th:classappend="${pageable.isLast()} ? 'disabled' : ''">
                                        <a class="page-link" th:if="${!pageable.isLast()}"
                                           th:href="@{/management/events(page=${pageable.getNumber()+1}, size=${pageSize}, sort=${sort}, query=${query}, id=${eventViewDto.id}, author=${eventViewDto.author}, title=${eventViewDto.title}, description=${eventViewDto.description}, tags=${eventViewDto.tags})}">
                                            <i class="arrow fas fa-chevron-right"></i>
                                        </a>
                                        <a class="page-link" th:if="${pageable.isLast()}"><i
                                                class="arrow fas fa-chevron-right"></i></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!-- End of Pagination-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Edit Modal HTML -->
    <div th:replace="core/fragments/modals/edit_event_modal.html"></div>
    <div th:replace="core/fragments/modals/confirmation-modal.html"></div>
    <div id="footer" th:insert="core/footer"></div>
    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/
        var backendAddress = /*[[${backendAddress}]]*/;
        /*]]>*/
    </script>

    <script th:src="@{/management/events/deleteEvents.js}"></script>

</body>
</html>